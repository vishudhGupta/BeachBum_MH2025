{% comment %}
  Renders a list of product's price (regular, sale)
  Adds discount percentage badge like "10% off"
{% endcomment %}

{%- liquid
  if use_variant
    assign target = product.selected_or_first_available_variant
  elsif placeholder
    assign target = null
  else
    assign target = product
  endif

  assign compare_at_price = target.compare_at_price
  assign price = target.price | default: 1999
  assign available = target.available | default: false
  assign price_min = product.price_min
  assign price_max = product.price_max
  assign money_price = price | money
  assign money_price_min = price_min | money
  assign money_price_max = price_max | money

  if settings.currency_code_enabled
    assign money_price = price | money_with_currency
    assign money_price_min = price_min | money_with_currency
    assign money_price_max = price_max | money_with_currency
  endif

  if target == product and product.price_varies
    assign money_price = 'products.product.price.from_price_html' | t: price: money_price
  endif

  comment
    Calculate discount percentage (if applicable)
  endcomment
  assign discount_percent = 0
  if compare_at_price > price
    assign discount_value = compare_at_price | minus: price
    assign discount_percent = discount_value | times: 100 | divided_by: compare_at_price | round
  endif
-%}

{%- unless target == null and placeholder == null -%}
  <div
    class="
      price
      {%- if price_class %} {{ price_class }}{% endif -%}
      {%- if available == false %} price--sold-out{% endif -%}
      {%- if compare_at_price > price %} price--on-sale{% endif -%}
      {%- if product.price_varies == false and product.compare_at_price_varies %} price--no-compare{% endif -%}
      {%- if show_badges %} price--show-badge{% endif -%}
    "
  >
    <div class="price__container">
      {%- if compare_at_price > price -%}
        <!-- On Sale -->
        <div class="price__sale">
          <s class="price-item price-item--regular">
            {% if settings.currency_code_enabled %}
              {{ compare_at_price | money_with_currency }}
            {% else %}
              {{ compare_at_price | money }}
            {% endif %}
          </s>
          <span class="price-item price-item--sale price-item--last">
            {{ money_price }}
          </span>

          {%- if discount_percent > 0 -%}
            <span class="price__discount-badge">
              {{ discount_percent }}% off
            </span>
          {%- endif -%}
        </div>
      {%- else -%}
        <!-- Regular Price -->
        <div class="price__regular">
          <span class="price-item price-item--regular">
            {{ money_price }}
          </span>
        </div>
      {%- endif -%}

      {%- if product.selected_or_first_available_variant.unit_price_measurement -%}
        {% render 'unit-price',
          price: product.selected_or_first_available_variant.unit_price,
          measurement: product.selected_or_first_available_variant.unit_price_measurement %}
      {%- endif -%}
    </div>
  </div>
{%- endunless -%}

<style>
.price__sale {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-wrap: wrap;
}

.price__discount-badge {
  background-color: #000;
  color: #fff;
  font-size: 12px;
  font-weight: 600;
  padding: 3px 8px;
  border-radius: 9999px;
  text-transform: lowercase;
  display: inline-block;
  line-height: 1.2;
}

.price__discount-badge::first-letter {
  text-transform: uppercase;
}

.price-item--regular {
  color: #888;
  {% comment %} text-decoration: line-through; {% endcomment %}
  font-size: 14px;
}

.price-item--sale {
  color: #d03a2e;
  font-weight: 700;
  font-size: 16px;
}

.price__container {
  display: flex;
  align-items: center;
  gap: 6px;
}
</style>
